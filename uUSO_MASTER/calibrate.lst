C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CALIBRATE
OBJECT MODULE PLACED IN calibrate.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE calibrate\calibrate.c LARGE OPTIMIZE(6,SPEED) BROWSE ORDER NO
                    -AREGS DEBUG OBJECTEXTEND CODE SYMBOLS PRINT(.\calibrate.lst) OBJECT(calibrate.obj)

line level    source

   1          #include "calibrate.h"
   2          //#pragma OT(6,Speed)
   3          //------------------------------------------------------------
   4          unsigned long GetCalibrateVal(unsigned char channel_num,unsigned long ADC_Code)   //преобразование значени
             -я АЦП в калиброванное значение         ??? проверить && debug
   5          {
   6   1              float result=0;
   7   1      
   8   1              result=ADC_Code*channels[channel_num].calibrate.cal.K+channels[channel_num].calibrate.cal.C;
   9   1      
  10   1              if(result>(float)0xFFFFFF)
  11   1              {
  12   2                      return 0xFFFFFF;
  13   2              }
  14   1              else
  15   1              {
  16   2                      if(result<0)
  17   2                      {
  18   3                              return 0;
  19   3                      }
  20   2                      else
  21   2                      {
  22   3                              return (unsigned long)result; 
  23   3                      }
  24   2              }
  25   1      }
  26          //------------------------------------------------------------
  27          void RestoreCalibrate(void)              //восстановление точек калибровки из EEPROM
  28          {
  29   1              unsigned char i=0;
  30   1              unsigned long crc=0,true_crc=0;
  31   1      
  32   1              for(i=0;i<CHANNEL_NUMBER;i++)
  33   1              {
  34   2                      EEPROM_Read(&channels[i].calibrate.serialize[0],3,ADC_CALIBRATE_ADDR+i*3);
  35   2              }
  36   1      
  37   1              true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
  38   1              EEPROM_Read(&crc,1,CALIBRATE_DEVICE_CRC_ADDR);//считаем CRC настроек
  39   1      
  40   1              if(true_crc!=crc)
  41   1              {
  42   2                      Calibrate_Set_Default();
  43   2              }
  44   1      
  45   1              return;
  46   1      }
  47          //---------------------------------------------------------------
  48          void Calibrate(unsigned char channel_num,float K,float C) //общая функция калибровки
  49          {
  50   1                      unsigned long true_crc=0;
  51   1                      channels[channel_num].calibrate.cal.K= K;
  52   1                      channels[channel_num].calibrate.cal.C= C;
  53   1                      EEPROM_Write(&channels[channel_num].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel_num*3);
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 2   

  54   1      
  55   1                      true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
  56   1                      EEPROM_Write(&true_crc,1,CALIBRATE_DEVICE_CRC_ADDR);//запомним CRC      
  57   1      
  58   1                      return;
  59   1      }
  60          //---------------------------------------------------------------
  61          unsigned char Calibrate_Get_CRC(void)//расчет crc  в eerprom
  62          {
  63   1               unsigned char crc = 0x0;
  64   1               unsigned char i=0,j=0;
  65   1      
  66   1           for(i=0;i<CHANNEL_NUMBER;i++)
  67   1               {
  68   2                      for(j=0;j<(3*sizeof(unsigned long));j++)
  69   2                      {
  70   3                              crc = Crc8Table[crc ^ (((unsigned char *)(&channels[i].calibrate.serialize))[j])];
  71   3                      }
  72   2               }
  73   1      
  74   1           return crc;
  75   1      }
  76          //---------------------------------------------------------------
  77          void Calibrate_Set_Flag(unsigned char channel,unsigned char flag)//установить/снять флаг калиброванности к
             -анала
  78          {
  79   1          unsigned long true_crc=0;
  80   1      
  81   1              if(flag==SET)
  82   1              {
  83   2                              channels[channel].calibrate.cal.calibrate=1;//установим/снимем флаг калибровки
  84   2                              EEPROM_Write(&channels[channel].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel*3);            
  85   2              }
  86   1              else
  87   1              {
  88   2                      if(flag==RESET)
  89   2                      {
  90   3                              channels[channel].calibrate.cal.calibrate=0;//установим/снимем флаг калибровки
  91   3                              EEPROM_Write(&channels[channel].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel*3);
  92   3                      }
  93   2              }
  94   1      
  95   1              true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
  96   1              EEPROM_Write(&true_crc,1,CALIBRATE_DEVICE_CRC_ADDR);//запомним CRC      
  97   1      }
  98          //----------------------------------------------------------------
  99          void Calibrate_Set_Default(void)//установка калибровки по умолчанию(отключена)
 100          {
 101   1                      unsigned char i=0;
 102   1                  unsigned long true_crc=0;           
 103   1      
 104   1                      for(i=0;i<CHANNEL_NUMBER;i++)
 105   1                      {
 106   2                              Calibrate_Set_Flag(i,RESET);
 107   2                      }
 108   1                      
 109   1                      true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
 110   1                      EEPROM_Write(&true_crc,1,CALIBRATE_DEVICE_CRC_ADDR);//запомним CRC              
 111   1      }
 112          //----------------------------------------------------------------
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _GetCalibrateVal (BEGIN)
                                           ; SOURCE LINE # 4
0000 900000      R     MOV     DPTR,#channel_num
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 5
                                           ; SOURCE LINE # 6
0005 900000      R     MOV     DPTR,#result
0008 120000      E     LCALL   ?C?LSTKXDATA
000B 00                DB      00H
000C 00                DB      00H
000D 00                DB      00H
000E 00                DB      00H
                                           ; SOURCE LINE # 8
000F 900000      R     MOV     DPTR,#ADC_Code
0012 E0                MOVX    A,@DPTR
0013 FC                MOV     R4,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FD                MOV     R5,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D E4                CLR     A
001E 120000      E     LCALL   ?C?FCASTL
0021 900000      R     MOV     DPTR,#channel_num
0024 E0                MOVX    A,@DPTR
0025 75F019            MOV     B,#019H
0028 A4                MUL     AB
0029 2400        E     ADD     A,#LOW channels+0EH
002B F582              MOV     DPL,A
002D E5F0              MOV     A,B
002F 3400        E     ADDC    A,#HIGH channels+0EH
0031 F583              MOV     DPH,A
0033 E0                MOVX    A,@DPTR
0034 F8                MOV     R0,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 F9                MOV     R1,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FA                MOV     R2,A
003B A3                INC     DPTR
003C E0                MOVX    A,@DPTR
003D FB                MOV     R3,A
003E 120000      E     LCALL   ?C?FPMUL
0041 900000      R     MOV     DPTR,#channel_num
0044 E0                MOVX    A,@DPTR
0045 75F019            MOV     B,#019H
0048 A4                MUL     AB
0049 2400        E     ADD     A,#LOW channels+012H
004B F582              MOV     DPL,A
004D E5F0              MOV     A,B
004F 3400        E     ADDC    A,#HIGH channels+012H
0051 F583              MOV     DPH,A
0053 E0                MOVX    A,@DPTR
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 4   

0054 F8                MOV     R0,A
0055 A3                INC     DPTR
0056 E0                MOVX    A,@DPTR
0057 F9                MOV     R1,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A FA                MOV     R2,A
005B A3                INC     DPTR
005C E0                MOVX    A,@DPTR
005D FB                MOV     R3,A
005E 120000      E     LCALL   ?C?FPADD
0061 900000      R     MOV     DPTR,#result
0064 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 10
0067 7FFF              MOV     R7,#0FFH
0069 7EFF              MOV     R6,#0FFH
006B 7D7F              MOV     R5,#07FH
006D 7C4B              MOV     R4,#04BH
006F 900000      R     MOV     DPTR,#result
0072 E0                MOVX    A,@DPTR
0073 F8                MOV     R0,A
0074 A3                INC     DPTR
0075 E0                MOVX    A,@DPTR
0076 F9                MOV     R1,A
0077 A3                INC     DPTR
0078 E0                MOVX    A,@DPTR
0079 FA                MOV     R2,A
007A A3                INC     DPTR
007B E0                MOVX    A,@DPTR
007C FB                MOV     R3,A
007D 120000      E     LCALL   ?C?FPCMP3
0080 600A              JZ      ?C0001
0082 4008              JC      ?C0001
                                           ; SOURCE LINE # 11
                                           ; SOURCE LINE # 12
0084 74FF              MOV     A,#0FFH
0086 FF                MOV     R7,A
0087 FE                MOV     R6,A
0088 FD                MOV     R5,A
0089 7C00              MOV     R4,#00H
008B 22                RET     
                                           ; SOURCE LINE # 13
008C         ?C0001:
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 16
008C E4                CLR     A
008D FF                MOV     R7,A
008E FE                MOV     R6,A
008F FD                MOV     R5,A
0090 FC                MOV     R4,A
0091 900000      R     MOV     DPTR,#result
0094 E0                MOVX    A,@DPTR
0095 F8                MOV     R0,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 F9                MOV     R1,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B FA                MOV     R2,A
009C A3                INC     DPTR
009D E0                MOVX    A,@DPTR
009E FB                MOV     R3,A
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 5   

009F 120000      E     LCALL   ?C?FPCMP3
00A2 5006              JNC     ?C0004
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 18
00A4 E4                CLR     A
00A5 FF                MOV     R7,A
00A6 FE                MOV     R6,A
00A7 FD                MOV     R5,A
00A8 FC                MOV     R4,A
00A9 22                RET     
                                           ; SOURCE LINE # 19
00AA         ?C0004:
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 22
00AA 900000      R     MOV     DPTR,#result
00AD E0                MOVX    A,@DPTR
00AE FC                MOV     R4,A
00AF A3                INC     DPTR
00B0 E0                MOVX    A,@DPTR
00B1 FD                MOV     R5,A
00B2 A3                INC     DPTR
00B3 E0                MOVX    A,@DPTR
00B4 FE                MOV     R6,A
00B5 A3                INC     DPTR
00B6 E0                MOVX    A,@DPTR
00B7 FF                MOV     R7,A
00B8 120000      E     LCALL   ?C?CASTF
                                           ; SOURCE LINE # 23
                                           ; SOURCE LINE # 24
                                           ; SOURCE LINE # 25
00BB         ?C0002:
00BB 22                RET     
             ; FUNCTION _GetCalibrateVal (END)

             ; FUNCTION RestoreCalibrate (BEGIN)
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 28
                                           ; SOURCE LINE # 29
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 30
0005 A3                INC     DPTR
0006 120000      E     LCALL   ?C?LSTKXDATA
0009 00                DB      00H
000A 00                DB      00H
000B 00                DB      00H
000C 00                DB      00H
000D 900000      R     MOV     DPTR,#true_crc
0010 120000      E     LCALL   ?C?LSTKXDATA
0013 00                DB      00H
0014 00                DB      00H
0015 00                DB      00H
0016 00                DB      00H
                                           ; SOURCE LINE # 32
0017 E4                CLR     A
0018 900000      R     MOV     DPTR,#i
001B F0                MOVX    @DPTR,A
001C         ?C0006:
001C 900000      R     MOV     DPTR,#i
001F E0                MOVX    A,@DPTR
0020 FF                MOV     R7,A
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 6   

0021 C3                CLR     C
0022 940E              SUBB    A,#0EH
0024 5030              JNC     ?C0007
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
0026 EF                MOV     A,R7
0027 75F019            MOV     B,#019H
002A A4                MUL     AB
002B 2400        E     ADD     A,#LOW channels+0DH
002D F9                MOV     R1,A
002E 7400        E     MOV     A,#HIGH channels+0DH
0030 35F0              ADDC    A,B
0032 FA                MOV     R2,A
0033 7B01              MOV     R3,#01H
0035 E0                MOVX    A,@DPTR
0036 75F003            MOV     B,#03H
0039 A4                MUL     AB
003A 2450              ADD     A,#050H
003C FE                MOV     R6,A
003D E4                CLR     A
003E 35F0              ADDC    A,B
0040 900000      E     MOV     DPTR,#?_EEPROM_Read?BYTE+05H
0043 F0                MOVX    @DPTR,A
0044 A3                INC     DPTR
0045 CE                XCH     A,R6
0046 F0                MOVX    @DPTR,A
0047 7D03              MOV     R5,#03H
0049 7C00              MOV     R4,#00H
004B 120000      E     LCALL   _EEPROM_Read
                                           ; SOURCE LINE # 35
004E 900000      R     MOV     DPTR,#i
0051 E0                MOVX    A,@DPTR
0052 04                INC     A
0053 F0                MOVX    @DPTR,A
0054 80C6              SJMP    ?C0006
0056         ?C0007:
                                           ; SOURCE LINE # 37
0056 120000      R     LCALL   Calibrate_Get_CRC
0059 E4                CLR     A
005A FC                MOV     R4,A
005B FD                MOV     R5,A
005C FE                MOV     R6,A
005D 900000      R     MOV     DPTR,#true_crc
0060 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 38
0063 7B01              MOV     R3,#01H
0065 7A00        R     MOV     R2,#HIGH crc
0067 7900        R     MOV     R1,#LOW crc
0069 900000      E     MOV     DPTR,#?_EEPROM_Read?BYTE+05H
006C E4                CLR     A
006D F0                MOVX    @DPTR,A
006E A3                INC     DPTR
006F 74A1              MOV     A,#0A1H
0071 F0                MOVX    @DPTR,A
0072 7D01              MOV     R5,#01H
0074 7C00              MOV     R4,#00H
0076 120000      E     LCALL   _EEPROM_Read
                                           ; SOURCE LINE # 40
0079 900000      R     MOV     DPTR,#crc
007C E0                MOVX    A,@DPTR
007D FC                MOV     R4,A
007E A3                INC     DPTR
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 7   

007F E0                MOVX    A,@DPTR
0080 FD                MOV     R5,A
0081 A3                INC     DPTR
0082 E0                MOVX    A,@DPTR
0083 FE                MOV     R6,A
0084 A3                INC     DPTR
0085 E0                MOVX    A,@DPTR
0086 FF                MOV     R7,A
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 F8                MOV     R0,A
008A A3                INC     DPTR
008B E0                MOVX    A,@DPTR
008C F9                MOV     R1,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F FA                MOV     R2,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FB                MOV     R3,A
0093 C3                CLR     C
0094 120000      E     LCALL   ?C?ULCMP
0097 6003              JZ      ?C0010
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
0099 120000      R     LCALL   Calibrate_Set_Default
                                           ; SOURCE LINE # 43
                                           ; SOURCE LINE # 46
009C         ?C0010:
009C 22                RET     
             ; FUNCTION RestoreCalibrate (END)

             ; FUNCTION _Calibrate (BEGIN)
                                           ; SOURCE LINE # 48
0000 900000      R     MOV     DPTR,#channel_num
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 49
                                           ; SOURCE LINE # 50
0005 900000      R     MOV     DPTR,#true_crc
0008 120000      E     LCALL   ?C?LSTKXDATA
000B 00                DB      00H
000C 00                DB      00H
000D 00                DB      00H
000E 00                DB      00H
                                           ; SOURCE LINE # 51
000F 900000      R     MOV     DPTR,#K
0012 E0                MOVX    A,@DPTR
0013 FC                MOV     R4,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FD                MOV     R5,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D 900000      R     MOV     DPTR,#channel_num
0020 E0                MOVX    A,@DPTR
0021 FB                MOV     R3,A
0022 75F019            MOV     B,#019H
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 8   

0025 A4                MUL     AB
0026 2400        E     ADD     A,#LOW channels+0EH
0028 F582              MOV     DPL,A
002A E5F0              MOV     A,B
002C 3400        E     ADDC    A,#HIGH channels+0EH
002E F583              MOV     DPH,A
0030 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 52
0033 900000      R     MOV     DPTR,#C
0036 E0                MOVX    A,@DPTR
0037 FC                MOV     R4,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FD                MOV     R5,A
003B A3                INC     DPTR
003C E0                MOVX    A,@DPTR
003D FE                MOV     R6,A
003E A3                INC     DPTR
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 75F019            MOV     B,#019H
0044 EB                MOV     A,R3
0045 A4                MUL     AB
0046 2400        E     ADD     A,#LOW channels+012H
0048 F582              MOV     DPL,A
004A E5F0              MOV     A,B
004C 3400        E     ADDC    A,#HIGH channels+012H
004E F583              MOV     DPH,A
0050 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 53
0053 EB                MOV     A,R3
0054 75F019            MOV     B,#019H
0057 A4                MUL     AB
0058 2400        E     ADD     A,#LOW channels+0DH
005A F9                MOV     R1,A
005B 7400        E     MOV     A,#HIGH channels+0DH
005D 35F0              ADDC    A,B
005F FA                MOV     R2,A
0060 7B01              MOV     R3,#01H
0062 900000      R     MOV     DPTR,#channel_num
0065 E0                MOVX    A,@DPTR
0066 75F003            MOV     B,#03H
0069 A4                MUL     AB
006A 2450              ADD     A,#050H
006C FE                MOV     R6,A
006D E4                CLR     A
006E 35F0              ADDC    A,B
0070 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
0073 F0                MOVX    @DPTR,A
0074 A3                INC     DPTR
0075 CE                XCH     A,R6
0076 F0                MOVX    @DPTR,A
0077 7D03              MOV     R5,#03H
0079 7C00              MOV     R4,#00H
007B 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 55
007E 120000      R     LCALL   Calibrate_Get_CRC
0081 E4                CLR     A
0082 FC                MOV     R4,A
0083 FD                MOV     R5,A
0084 FE                MOV     R6,A
0085 900000      R     MOV     DPTR,#true_crc
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 9   

0088 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 56
008B 7B01              MOV     R3,#01H
008D 7A00        R     MOV     R2,#HIGH true_crc
008F 7900        R     MOV     R1,#LOW true_crc
0091 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
0094 E4                CLR     A
0095 F0                MOVX    @DPTR,A
0096 A3                INC     DPTR
0097 74A1              MOV     A,#0A1H
0099 F0                MOVX    @DPTR,A
009A 7D01              MOV     R5,#01H
009C 7C00              MOV     R4,#00H
009E 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 59
00A1         ?C0011:
00A1 22                RET     
             ; FUNCTION _Calibrate (END)

             ; FUNCTION Calibrate_Get_CRC (BEGIN)
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
                                           ; SOURCE LINE # 63
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#crc
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 64
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 66
0009 900000      R     MOV     DPTR,#i
000C F0                MOVX    @DPTR,A
000D         ?C0012:
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
000D E4                CLR     A
000E 900000      R     MOV     DPTR,#j
0011 F0                MOVX    @DPTR,A
0012         ?C0015:
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 70
0012 900000      R     MOV     DPTR,#i
0015 E0                MOVX    A,@DPTR
0016 75F019            MOV     B,#019H
0019 A4                MUL     AB
001A 2400        E     ADD     A,#LOW channels+0DH
001C F9                MOV     R1,A
001D 7400        E     MOV     A,#HIGH channels+0DH
001F 35F0              ADDC    A,B
0021 FA                MOV     R2,A
0022 7B01              MOV     R3,#01H
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 7E00              MOV     R6,#00H
0028 29                ADD     A,R1
0029 F9                MOV     R1,A
002A EE                MOV     A,R6
002B 3A                ADDC    A,R2
002C FA                MOV     R2,A
002D 120000      E     LCALL   ?C?CLDPTR
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 10  

0030 FF                MOV     R7,A
0031 900000      R     MOV     DPTR,#crc
0034 E0                MOVX    A,@DPTR
0035 6F                XRL     A,R7
0036 900000      E     MOV     DPTR,#Crc8Table
0039 93                MOVC    A,@A+DPTR
003A 900000      R     MOV     DPTR,#crc
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 71
003E 900000      R     MOV     DPTR,#j
0041 E0                MOVX    A,@DPTR
0042 04                INC     A
0043 F0                MOVX    @DPTR,A
0044 E0                MOVX    A,@DPTR
0045 B40CCA            CJNE    A,#0CH,?C0015
                                           ; SOURCE LINE # 72
0048         ?C0014:
0048 900000      R     MOV     DPTR,#i
004B E0                MOVX    A,@DPTR
004C 04                INC     A
004D F0                MOVX    @DPTR,A
004E E0                MOVX    A,@DPTR
004F B40EBB            CJNE    A,#0EH,?C0012
0052         ?C0013:
                                           ; SOURCE LINE # 74
0052 900000      R     MOV     DPTR,#crc
0055 E0                MOVX    A,@DPTR
0056 FF                MOV     R7,A
                                           ; SOURCE LINE # 75
0057         ?C0018:
0057 22                RET     
             ; FUNCTION Calibrate_Get_CRC (END)

             ; FUNCTION _Calibrate_Set_Flag (BEGIN)
                                           ; SOURCE LINE # 77
0000 900000      R     MOV     DPTR,#channel
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
0008 FB                MOV     R3,A
                                           ; SOURCE LINE # 78
                                           ; SOURCE LINE # 79
0009 A3                INC     DPTR
000A 120000      E     LCALL   ?C?LSTKXDATA
000D 00                DB      00H
000E 00                DB      00H
000F 00                DB      00H
0010 00                DB      00H
                                           ; SOURCE LINE # 81
0011 EB                MOV     A,R3
0012 6401              XRL     A,#01H
0014 7043              JNZ     ?C0019
                                           ; SOURCE LINE # 82
                                           ; SOURCE LINE # 83
0016 900000      R     MOV     DPTR,#channel
0019 E0                MOVX    A,@DPTR
001A FF                MOV     R7,A
001B 75F019            MOV     B,#019H
001E A4                MUL     AB
001F 2400        E     ADD     A,#LOW channels+0DH
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 11  

0021 F582              MOV     DPL,A
0023 E5F0              MOV     A,B
0025 3400        E     ADDC    A,#HIGH channels+0DH
0027 F583              MOV     DPH,A
0029 7401              MOV     A,#01H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 84
002C EF                MOV     A,R7
002D 75F019            MOV     B,#019H
0030 A4                MUL     AB
0031 2400        E     ADD     A,#LOW channels+0DH
0033 F9                MOV     R1,A
0034 7400        E     MOV     A,#HIGH channels+0DH
0036 35F0              ADDC    A,B
0038 FA                MOV     R2,A
0039 7B01              MOV     R3,#01H
003B 900000      R     MOV     DPTR,#channel
003E E0                MOVX    A,@DPTR
003F 75F003            MOV     B,#03H
0042 A4                MUL     AB
0043 2450              ADD     A,#050H
0045 FE                MOV     R6,A
0046 E4                CLR     A
0047 35F0              ADDC    A,B
0049 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
004C F0                MOVX    @DPTR,A
004D A3                INC     DPTR
004E CE                XCH     A,R6
004F F0                MOVX    @DPTR,A
0050 7D03              MOV     R5,#03H
0052 7C00              MOV     R4,#00H
0054 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 85
0057 8046              SJMP    ?C0020
0059         ?C0019:
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
0059 900000      R     MOV     DPTR,#flag
005C E0                MOVX    A,@DPTR
005D 7040              JNZ     ?C0020
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 90
005F 900000      R     MOV     DPTR,#channel
0062 E0                MOVX    A,@DPTR
0063 FF                MOV     R7,A
0064 75F019            MOV     B,#019H
0067 A4                MUL     AB
0068 2400        E     ADD     A,#LOW channels+0DH
006A F582              MOV     DPL,A
006C E5F0              MOV     A,B
006E 3400        E     ADDC    A,#HIGH channels+0DH
0070 F583              MOV     DPH,A
0072 E4                CLR     A
0073 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 91
0074 EF                MOV     A,R7
0075 75F019            MOV     B,#019H
0078 A4                MUL     AB
0079 2400        E     ADD     A,#LOW channels+0DH
007B F9                MOV     R1,A
007C 7400        E     MOV     A,#HIGH channels+0DH
007E 35F0              ADDC    A,B
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 12  

0080 FA                MOV     R2,A
0081 7B01              MOV     R3,#01H
0083 900000      R     MOV     DPTR,#channel
0086 E0                MOVX    A,@DPTR
0087 75F003            MOV     B,#03H
008A A4                MUL     AB
008B 2450              ADD     A,#050H
008D FE                MOV     R6,A
008E E4                CLR     A
008F 35F0              ADDC    A,B
0091 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
0094 F0                MOVX    @DPTR,A
0095 A3                INC     DPTR
0096 CE                XCH     A,R6
0097 F0                MOVX    @DPTR,A
0098 7D03              MOV     R5,#03H
009A 7C00              MOV     R4,#00H
009C 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 92
                                           ; SOURCE LINE # 93
009F         ?C0020:
                                           ; SOURCE LINE # 95
009F 120000      R     LCALL   Calibrate_Get_CRC
00A2 E4                CLR     A
00A3 FC                MOV     R4,A
00A4 FD                MOV     R5,A
00A5 FE                MOV     R6,A
00A6 900000      R     MOV     DPTR,#true_crc
00A9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 96
00AC 7B01              MOV     R3,#01H
00AE 7A00        R     MOV     R2,#HIGH true_crc
00B0 7900        R     MOV     R1,#LOW true_crc
00B2 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
00B5 E4                CLR     A
00B6 F0                MOVX    @DPTR,A
00B7 A3                INC     DPTR
00B8 74A1              MOV     A,#0A1H
00BA F0                MOVX    @DPTR,A
00BB 7D01              MOV     R5,#01H
00BD 7C00              MOV     R4,#00H
00BF 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 97
00C2 22                RET     
             ; FUNCTION _Calibrate_Set_Flag (END)

             ; FUNCTION Calibrate_Set_Default (BEGIN)
                                           ; SOURCE LINE # 99
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 101
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 102
0005 A3                INC     DPTR
0006 120000      E     LCALL   ?C?LSTKXDATA
0009 00                DB      00H
000A 00                DB      00H
000B 00                DB      00H
000C 00                DB      00H
                                           ; SOURCE LINE # 104
000D E4                CLR     A
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 13  

000E 900000      R     MOV     DPTR,#i
0011 F0                MOVX    @DPTR,A
0012         ?C0023:
0012 900000      R     MOV     DPTR,#i
0015 E0                MOVX    A,@DPTR
0016 FF                MOV     R7,A
0017 C3                CLR     C
0018 940E              SUBB    A,#0EH
001A 500D              JNC     ?C0024
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 106
001C E4                CLR     A
001D FD                MOV     R5,A
001E 120000      R     LCALL   _Calibrate_Set_Flag
                                           ; SOURCE LINE # 107
0021 900000      R     MOV     DPTR,#i
0024 E0                MOVX    A,@DPTR
0025 04                INC     A
0026 F0                MOVX    @DPTR,A
0027 80E9              SJMP    ?C0023
0029         ?C0024:
                                           ; SOURCE LINE # 109
0029 120000      R     LCALL   Calibrate_Get_CRC
002C E4                CLR     A
002D FC                MOV     R4,A
002E FD                MOV     R5,A
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#true_crc
0033 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 110
0036 7B01              MOV     R3,#01H
0038 7A00        R     MOV     R2,#HIGH true_crc
003A 7900        R     MOV     R1,#LOW true_crc
003C 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
003F E4                CLR     A
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 74A1              MOV     A,#0A1H
0044 F0                MOVX    @DPTR,A
0045 7D01              MOV     R5,#01H
0047 7C00              MOV     R4,#00H
0049 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 111
004C 22                RET     
             ; FUNCTION Calibrate_Set_Default (END)

C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 14  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
SCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
WDCON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C0H  1
T2CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
ADCSTAT. . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D8H  1
I2CCON . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
DCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
SPICON . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00F8H  1
_EEPROM_Read . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
_EEPROM_Write. . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
Channel. . . . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  25
  number . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  settings . . . . . . . . . . . . . .  MEMBER   -----  UNION    0001H  4
  channel_data . . . . . . . . . . . .  MEMBER   -----  U_LONG   0005H  4
  channel_data_calibrate . . . . . . .  MEMBER   -----  U_LONG   0009H  4
  calibrate. . . . . . . . . . . . . .  MEMBER   -----  UNION    000DH  12
lc_t . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
pt . . . . . . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  4
  lc . . . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
  pt_time. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0002H  2
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
ADC_Channels . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  38
  ADC_BUF_UN . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  32
  adc_buf_counter. . . . . . . . . . .  MEMBER   -----  U_CHAR   0020H  1
  ADC_SF . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0021H  1
  ADC_GAIN . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0022H  1
  buffered . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0023H  1
  unipolar . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0024H  1
  new_measuring. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0025H  1
channels . . . . . . . . . . . . . . .  EXTERN   XDATA  ARRAY    -----  350
Crc8Table. . . . . . . . . . . . . . .  EXTERN   CODE   ARRAY    -----  -----
RESET. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
SET. . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
_Calibrate . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  channel_num. . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  K. . . . . . . . . . . . . . . . . .  AUTO     XDATA  FLOAT    0001H  4
  C. . . . . . . . . . . . . . . . . .  AUTO     XDATA  FLOAT    0005H  4
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0009H  4
RestoreCalibrate . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  crc. . . . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0001H  4
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0005H  4
_GetCalibrateVal . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  channel_num. . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  ADC_Code . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0001H  4
  result . . . . . . . . . . . . . . .  AUTO     XDATA  FLOAT    0005H  4
Calibrate_Get_CRC. . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  crc. . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  i. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0001H  1
  j. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0002H  1
_Calibrate_Set_Flag. . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  channel. . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
C51 COMPILER V9.00   CALIBRATE                                                             06/20/2014 09:02:40 PAGE 15  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  flag . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0001H  1
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0002H  4
Calibrate_Set_Default. . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0001H  4


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    867    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      45
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
