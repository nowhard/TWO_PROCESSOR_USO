C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CALIBRATE
OBJECT MODULE PLACED IN calibrate.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE calibrate\calibrate.c LARGE OPTIMIZE(6,SPEED) BROWSE ORDER NO
                    -AREGS DEBUG OBJECTEXTEND CODE SYMBOLS PRINT(.\calibrate.lst) OBJECT(calibrate.obj)

line level    source

   1          #include "calibrate.h"
   2          //#pragma OT(6,Speed)
   3          //------------------------------------------------------------
   4          unsigned long GetCalibrateVal(unsigned char channel_num,unsigned long ADC_Code)   //преобразование значени
             -я АЦП в калиброванное значение         ??? проверить && debug
   5          {
   6   1              float result=0;
   7   1      
   8   1              result=ADC_Code*channels[channel_num].calibrate.cal.K+channels[channel_num].calibrate.cal.C;
   9   1      
  10   1              if(result>(float)0xFFFFFF)
  11   1              {
  12   2                      return 0xFFFFFF;
  13   2              }
  14   1              else
  15   1              {
  16   2                      if(result<0)
  17   2                      {
  18   3                              return 0;
  19   3                      }
  20   2                      else
  21   2                      {
  22   3                              return (unsigned long)result; 
  23   3                      }
  24   2              }
  25   1      }
  26          //------------------------------------------------------------
  27          void RestoreCalibrate(void)              //восстановление точек калибровки из EEPROM
  28          {
  29   1              unsigned char i=0;
  30   1              unsigned long crc=0,true_crc=0;
  31   1      
  32   1              for(i=0;i<CHANNEL_NUMBER;i++)
  33   1              {
  34   2                      EEPROM_Read(&channels[i].calibrate.serialize[0],3,ADC_CALIBRATE_ADDR+i*3);
  35   2              }
  36   1      
  37   1              true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
  38   1              EEPROM_Read(&crc,1,CALIBRATE_DEVICE_CRC_ADDR);//считаем CRC настроек
  39   1      
  40   1              if(true_crc!=crc)
  41   1              {
  42   2                      Calibrate_Set_Default();
  43   2              }
  44   1      
  45   1              return;
  46   1      }
  47          //---------------------------------------------------------------
  48          void Calibrate(unsigned char channel_num,float K,float C) //общая функция калибровки
  49          {
  50   1                      unsigned long true_crc=0;
  51   1                      channels[channel_num].calibrate.cal.K= K;
  52   1                      channels[channel_num].calibrate.cal.C= C;
  53   1                      EEPROM_Write(&channels[channel_num].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel_num*3);
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 2   

  54   1      
  55   1                      true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
  56   1                      EEPROM_Write(&true_crc,1,CALIBRATE_DEVICE_CRC_ADDR);//запомним CRC      
  57   1      
  58   1                      return;
  59   1      }
  60          //---------------------------------------------------------------
  61          unsigned char Calibrate_Get_CRC(void)//расчет crc  в eerprom
  62          {
  63   1               unsigned char crc = 0x0;
  64   1               unsigned char i=0,j=0;
  65   1      
  66   1           for(i=0;i<CHANNEL_NUMBER;i++)
  67   1               {
  68   2                      for(j=0;j<(3*sizeof(unsigned long));j++)
  69   2                      {
  70   3                              crc = Crc8Table[crc ^ (((unsigned char *)(&channels[i].calibrate.serialize))[j])];
  71   3                      }
  72   2               }
  73   1      
  74   1           return crc;
  75   1      }
  76          //---------------------------------------------------------------
  77          void Calibrate_Set_Flag(unsigned char channel,unsigned char flag)//установить/снять флаг калиброванности к
             -анала
  78          {
  79   1          unsigned long true_crc=0;
  80   1      
  81   1              if(flag==SET)
  82   1              {
  83   2                              channels[channel].calibrate.cal.calibrate=1;//установим/снимем флаг калибровки
  84   2                              EEPROM_Write(&channels[channel].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel*3);            
  85   2              }
  86   1              else
  87   1              {
  88   2                      if(flag==RESET)
  89   2                      {
  90   3                              channels[channel].calibrate.cal.calibrate=0;//установим/снимем флаг калибровки
  91   3                              EEPROM_Write(&channels[channel].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel*3);
  92   3                      }
  93   2              }
  94   1      
  95   1              true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
  96   1              EEPROM_Write(&true_crc,1,CALIBRATE_DEVICE_CRC_ADDR);//запомним CRC      
  97   1      }
  98          //----------------------------------------------------------------
  99          void Calibrate_Set_Default(void)//установка калибровки по умолчанию(отключена)
 100          {
 101   1                      unsigned char i=0;
 102   1                  unsigned long true_crc=0;           
 103   1      
 104   1                      for(i=0;i<CHANNEL_NUMBER;i++)
 105   1                      {
 106   2                              Calibrate_Set_Flag(i,RESET);
 107   2                      }
 108   1                      
 109   1                      true_crc= (unsigned long)Calibrate_Get_CRC();//расчет текущей CRC калибровок
 110   1                      EEPROM_Write(&true_crc,1,CALIBRATE_DEVICE_CRC_ADDR);//запомним CRC              
 111   1      }
 112          //----------------------------------------------------------------
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _GetCalibrateVal (BEGIN)
                                           ; SOURCE LINE # 4
0000 900000      R     MOV     DPTR,#channel_num
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 5
                                           ; SOURCE LINE # 6
0005 900000      R     MOV     DPTR,#result
0008 120000      E     LCALL   ?C?LSTKXDATA
000B 00                DB      00H
000C 00                DB      00H
000D 00                DB      00H
000E 00                DB      00H
                                           ; SOURCE LINE # 8
000F 900000      R     MOV     DPTR,#ADC_Code
0012 E0                MOVX    A,@DPTR
0013 FC                MOV     R4,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FD                MOV     R5,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D E4                CLR     A
001E 120000      E     LCALL   ?C?FCASTL
0021 900000      R     MOV     DPTR,#channel_num
0024 E0                MOVX    A,@DPTR
0025 75F019            MOV     B,#019H
0028 A4                MUL     AB
0029 2400        E     ADD     A,#LOW channels+0EH
002B F582              MOV     DPL,A
002D E4                CLR     A
002E 3400        E     ADDC    A,#HIGH channels+0EH
0030 F583              MOV     DPH,A
0032 E0                MOVX    A,@DPTR
0033 F8                MOV     R0,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 F9                MOV     R1,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FA                MOV     R2,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C FB                MOV     R3,A
003D 120000      E     LCALL   ?C?FPMUL
0040 900000      R     MOV     DPTR,#channel_num
0043 E0                MOVX    A,@DPTR
0044 75F019            MOV     B,#019H
0047 A4                MUL     AB
0048 2400        E     ADD     A,#LOW channels+012H
004A F582              MOV     DPL,A
004C E4                CLR     A
004D 3400        E     ADDC    A,#HIGH channels+012H
004F F583              MOV     DPH,A
0051 E0                MOVX    A,@DPTR
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 4   

0052 F8                MOV     R0,A
0053 A3                INC     DPTR
0054 E0                MOVX    A,@DPTR
0055 F9                MOV     R1,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FA                MOV     R2,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FB                MOV     R3,A
005C 120000      E     LCALL   ?C?FPADD
005F 900000      R     MOV     DPTR,#result
0062 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 10
0065 7FFF              MOV     R7,#0FFH
0067 7EFF              MOV     R6,#0FFH
0069 7D7F              MOV     R5,#07FH
006B 7C4B              MOV     R4,#04BH
006D 900000      R     MOV     DPTR,#result
0070 E0                MOVX    A,@DPTR
0071 F8                MOV     R0,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 F9                MOV     R1,A
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 FA                MOV     R2,A
0078 A3                INC     DPTR
0079 E0                MOVX    A,@DPTR
007A FB                MOV     R3,A
007B 120000      E     LCALL   ?C?FPCMP3
007E 600A              JZ      ?C0001
0080 4008              JC      ?C0001
                                           ; SOURCE LINE # 11
                                           ; SOURCE LINE # 12
0082 74FF              MOV     A,#0FFH
0084 FF                MOV     R7,A
0085 FE                MOV     R6,A
0086 FD                MOV     R5,A
0087 7C00              MOV     R4,#00H
0089 22                RET     
                                           ; SOURCE LINE # 13
008A         ?C0001:
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 16
008A E4                CLR     A
008B FF                MOV     R7,A
008C FE                MOV     R6,A
008D FD                MOV     R5,A
008E FC                MOV     R4,A
008F 900000      R     MOV     DPTR,#result
0092 E0                MOVX    A,@DPTR
0093 F8                MOV     R0,A
0094 A3                INC     DPTR
0095 E0                MOVX    A,@DPTR
0096 F9                MOV     R1,A
0097 A3                INC     DPTR
0098 E0                MOVX    A,@DPTR
0099 FA                MOV     R2,A
009A A3                INC     DPTR
009B E0                MOVX    A,@DPTR
009C FB                MOV     R3,A
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 5   

009D 120000      E     LCALL   ?C?FPCMP3
00A0 5006              JNC     ?C0004
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 18
00A2 E4                CLR     A
00A3 FF                MOV     R7,A
00A4 FE                MOV     R6,A
00A5 FD                MOV     R5,A
00A6 FC                MOV     R4,A
00A7 22                RET     
                                           ; SOURCE LINE # 19
00A8         ?C0004:
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 22
00A8 900000      R     MOV     DPTR,#result
00AB E0                MOVX    A,@DPTR
00AC FC                MOV     R4,A
00AD A3                INC     DPTR
00AE E0                MOVX    A,@DPTR
00AF FD                MOV     R5,A
00B0 A3                INC     DPTR
00B1 E0                MOVX    A,@DPTR
00B2 FE                MOV     R6,A
00B3 A3                INC     DPTR
00B4 E0                MOVX    A,@DPTR
00B5 FF                MOV     R7,A
00B6 120000      E     LCALL   ?C?CASTF
                                           ; SOURCE LINE # 23
                                           ; SOURCE LINE # 24
                                           ; SOURCE LINE # 25
00B9         ?C0002:
00B9 22                RET     
             ; FUNCTION _GetCalibrateVal (END)

             ; FUNCTION RestoreCalibrate (BEGIN)
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 28
                                           ; SOURCE LINE # 29
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 30
0005 A3                INC     DPTR
0006 120000      E     LCALL   ?C?LSTKXDATA
0009 00                DB      00H
000A 00                DB      00H
000B 00                DB      00H
000C 00                DB      00H
000D 900000      R     MOV     DPTR,#true_crc
0010 120000      E     LCALL   ?C?LSTKXDATA
0013 00                DB      00H
0014 00                DB      00H
0015 00                DB      00H
0016 00                DB      00H
                                           ; SOURCE LINE # 32
0017 E4                CLR     A
0018 900000      R     MOV     DPTR,#i
001B F0                MOVX    @DPTR,A
001C         ?C0006:
001C 900000      R     MOV     DPTR,#i
001F E0                MOVX    A,@DPTR
0020 FF                MOV     R7,A
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 6   

0021 C3                CLR     C
0022 9406              SUBB    A,#06H
0024 5030              JNC     ?C0007
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
0026 EF                MOV     A,R7
0027 75F019            MOV     B,#019H
002A A4                MUL     AB
002B 2400        E     ADD     A,#LOW channels+0DH
002D F9                MOV     R1,A
002E 7400        E     MOV     A,#HIGH channels+0DH
0030 35F0              ADDC    A,B
0032 FA                MOV     R2,A
0033 7B01              MOV     R3,#01H
0035 E0                MOVX    A,@DPTR
0036 75F003            MOV     B,#03H
0039 A4                MUL     AB
003A 2450              ADD     A,#050H
003C FE                MOV     R6,A
003D E4                CLR     A
003E 35F0              ADDC    A,B
0040 900000      E     MOV     DPTR,#?_EEPROM_Read?BYTE+05H
0043 F0                MOVX    @DPTR,A
0044 A3                INC     DPTR
0045 CE                XCH     A,R6
0046 F0                MOVX    @DPTR,A
0047 7D03              MOV     R5,#03H
0049 7C00              MOV     R4,#00H
004B 120000      E     LCALL   _EEPROM_Read
                                           ; SOURCE LINE # 35
004E 900000      R     MOV     DPTR,#i
0051 E0                MOVX    A,@DPTR
0052 04                INC     A
0053 F0                MOVX    @DPTR,A
0054 80C6              SJMP    ?C0006
0056         ?C0007:
                                           ; SOURCE LINE # 37
0056 120000      R     LCALL   Calibrate_Get_CRC
0059 E4                CLR     A
005A FC                MOV     R4,A
005B FD                MOV     R5,A
005C FE                MOV     R6,A
005D 900000      R     MOV     DPTR,#true_crc
0060 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 38
0063 7B01              MOV     R3,#01H
0065 7A00        R     MOV     R2,#HIGH crc
0067 7900        R     MOV     R1,#LOW crc
0069 900000      E     MOV     DPTR,#?_EEPROM_Read?BYTE+05H
006C E4                CLR     A
006D F0                MOVX    @DPTR,A
006E A3                INC     DPTR
006F 74A1              MOV     A,#0A1H
0071 F0                MOVX    @DPTR,A
0072 7D01              MOV     R5,#01H
0074 7C00              MOV     R4,#00H
0076 120000      E     LCALL   _EEPROM_Read
                                           ; SOURCE LINE # 40
0079 900000      R     MOV     DPTR,#crc
007C E0                MOVX    A,@DPTR
007D FC                MOV     R4,A
007E A3                INC     DPTR
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 7   

007F E0                MOVX    A,@DPTR
0080 FD                MOV     R5,A
0081 A3                INC     DPTR
0082 E0                MOVX    A,@DPTR
0083 FE                MOV     R6,A
0084 A3                INC     DPTR
0085 E0                MOVX    A,@DPTR
0086 FF                MOV     R7,A
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 F8                MOV     R0,A
008A A3                INC     DPTR
008B E0                MOVX    A,@DPTR
008C F9                MOV     R1,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F FA                MOV     R2,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FB                MOV     R3,A
0093 C3                CLR     C
0094 120000      E     LCALL   ?C?ULCMP
0097 6003              JZ      ?C0010
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
0099 120000      R     LCALL   Calibrate_Set_Default
                                           ; SOURCE LINE # 43
                                           ; SOURCE LINE # 46
009C         ?C0010:
009C 22                RET     
             ; FUNCTION RestoreCalibrate (END)

             ; FUNCTION _Calibrate (BEGIN)
                                           ; SOURCE LINE # 48
0000 900000      R     MOV     DPTR,#channel_num
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 49
                                           ; SOURCE LINE # 50
0005 900000      R     MOV     DPTR,#true_crc
0008 120000      E     LCALL   ?C?LSTKXDATA
000B 00                DB      00H
000C 00                DB      00H
000D 00                DB      00H
000E 00                DB      00H
                                           ; SOURCE LINE # 51
000F 900000      R     MOV     DPTR,#K
0012 E0                MOVX    A,@DPTR
0013 FC                MOV     R4,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FD                MOV     R5,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D 900000      R     MOV     DPTR,#channel_num
0020 E0                MOVX    A,@DPTR
0021 FB                MOV     R3,A
0022 75F019            MOV     B,#019H
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 8   

0025 A4                MUL     AB
0026 2400        E     ADD     A,#LOW channels+0EH
0028 F582              MOV     DPL,A
002A E4                CLR     A
002B 3400        E     ADDC    A,#HIGH channels+0EH
002D F583              MOV     DPH,A
002F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 52
0032 900000      R     MOV     DPTR,#C
0035 E0                MOVX    A,@DPTR
0036 FC                MOV     R4,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FD                MOV     R5,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C FE                MOV     R6,A
003D A3                INC     DPTR
003E E0                MOVX    A,@DPTR
003F FF                MOV     R7,A
0040 EB                MOV     A,R3
0041 75F019            MOV     B,#019H
0044 A4                MUL     AB
0045 2400        E     ADD     A,#LOW channels+012H
0047 F582              MOV     DPL,A
0049 E4                CLR     A
004A 3400        E     ADDC    A,#HIGH channels+012H
004C F583              MOV     DPH,A
004E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 53
0051 EB                MOV     A,R3
0052 75F019            MOV     B,#019H
0055 A4                MUL     AB
0056 2400        E     ADD     A,#LOW channels+0DH
0058 F9                MOV     R1,A
0059 7400        E     MOV     A,#HIGH channels+0DH
005B 35F0              ADDC    A,B
005D FA                MOV     R2,A
005E 7B01              MOV     R3,#01H
0060 900000      R     MOV     DPTR,#channel_num
0063 E0                MOVX    A,@DPTR
0064 75F003            MOV     B,#03H
0067 A4                MUL     AB
0068 2450              ADD     A,#050H
006A FE                MOV     R6,A
006B E4                CLR     A
006C 35F0              ADDC    A,B
006E 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
0071 F0                MOVX    @DPTR,A
0072 A3                INC     DPTR
0073 CE                XCH     A,R6
0074 F0                MOVX    @DPTR,A
0075 7D03              MOV     R5,#03H
0077 7C00              MOV     R4,#00H
0079 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 55
007C 120000      R     LCALL   Calibrate_Get_CRC
007F E4                CLR     A
0080 FC                MOV     R4,A
0081 FD                MOV     R5,A
0082 FE                MOV     R6,A
0083 900000      R     MOV     DPTR,#true_crc
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 9   

0086 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 56
0089 7B01              MOV     R3,#01H
008B 7A00        R     MOV     R2,#HIGH true_crc
008D 7900        R     MOV     R1,#LOW true_crc
008F 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
0092 E4                CLR     A
0093 F0                MOVX    @DPTR,A
0094 A3                INC     DPTR
0095 74A1              MOV     A,#0A1H
0097 F0                MOVX    @DPTR,A
0098 7D01              MOV     R5,#01H
009A 7C00              MOV     R4,#00H
009C 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 59
009F         ?C0011:
009F 22                RET     
             ; FUNCTION _Calibrate (END)

             ; FUNCTION Calibrate_Get_CRC (BEGIN)
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
                                           ; SOURCE LINE # 63
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#crc
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 64
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 66
0009 900000      R     MOV     DPTR,#i
000C F0                MOVX    @DPTR,A
000D         ?C0012:
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
000D E4                CLR     A
000E 900000      R     MOV     DPTR,#j
0011 F0                MOVX    @DPTR,A
0012         ?C0015:
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 70
0012 900000      R     MOV     DPTR,#i
0015 E0                MOVX    A,@DPTR
0016 75F019            MOV     B,#019H
0019 A4                MUL     AB
001A 2400        E     ADD     A,#LOW channels+0DH
001C F9                MOV     R1,A
001D 7400        E     MOV     A,#HIGH channels+0DH
001F 35F0              ADDC    A,B
0021 FA                MOV     R2,A
0022 7B01              MOV     R3,#01H
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 7E00              MOV     R6,#00H
0028 29                ADD     A,R1
0029 F9                MOV     R1,A
002A EE                MOV     A,R6
002B 3A                ADDC    A,R2
002C FA                MOV     R2,A
002D 120000      E     LCALL   ?C?CLDPTR
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 10  

0030 FF                MOV     R7,A
0031 900000      R     MOV     DPTR,#crc
0034 E0                MOVX    A,@DPTR
0035 6F                XRL     A,R7
0036 900000      E     MOV     DPTR,#Crc8Table
0039 93                MOVC    A,@A+DPTR
003A 900000      R     MOV     DPTR,#crc
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 71
003E 900000      R     MOV     DPTR,#j
0041 E0                MOVX    A,@DPTR
0042 04                INC     A
0043 F0                MOVX    @DPTR,A
0044 E0                MOVX    A,@DPTR
0045 B40CCA            CJNE    A,#0CH,?C0015
                                           ; SOURCE LINE # 72
0048         ?C0014:
0048 900000      R     MOV     DPTR,#i
004B E0                MOVX    A,@DPTR
004C 04                INC     A
004D F0                MOVX    @DPTR,A
004E E0                MOVX    A,@DPTR
004F B406BB            CJNE    A,#06H,?C0012
0052         ?C0013:
                                           ; SOURCE LINE # 74
0052 900000      R     MOV     DPTR,#crc
0055 E0                MOVX    A,@DPTR
0056 FF                MOV     R7,A
                                           ; SOURCE LINE # 75
0057         ?C0018:
0057 22                RET     
             ; FUNCTION Calibrate_Get_CRC (END)

             ; FUNCTION _Calibrate_Set_Flag (BEGIN)
                                           ; SOURCE LINE # 77
0000 900000      R     MOV     DPTR,#channel
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
0008 FB                MOV     R3,A
                                           ; SOURCE LINE # 78
                                           ; SOURCE LINE # 79
0009 A3                INC     DPTR
000A 120000      E     LCALL   ?C?LSTKXDATA
000D 00                DB      00H
000E 00                DB      00H
000F 00                DB      00H
0010 00                DB      00H
                                           ; SOURCE LINE # 81
0011 EB                MOV     A,R3
0012 6401              XRL     A,#01H
0014 7042              JNZ     ?C0019
                                           ; SOURCE LINE # 82
                                           ; SOURCE LINE # 83
0016 900000      R     MOV     DPTR,#channel
0019 E0                MOVX    A,@DPTR
001A FF                MOV     R7,A
001B 75F019            MOV     B,#019H
001E A4                MUL     AB
001F 2400        E     ADD     A,#LOW channels+0DH
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 11  

0021 F582              MOV     DPL,A
0023 E4                CLR     A
0024 3400        E     ADDC    A,#HIGH channels+0DH
0026 F583              MOV     DPH,A
0028 7401              MOV     A,#01H
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 84
002B EF                MOV     A,R7
002C 75F019            MOV     B,#019H
002F A4                MUL     AB
0030 2400        E     ADD     A,#LOW channels+0DH
0032 F9                MOV     R1,A
0033 7400        E     MOV     A,#HIGH channels+0DH
0035 35F0              ADDC    A,B
0037 FA                MOV     R2,A
0038 7B01              MOV     R3,#01H
003A 900000      R     MOV     DPTR,#channel
003D E0                MOVX    A,@DPTR
003E 75F003            MOV     B,#03H
0041 A4                MUL     AB
0042 2450              ADD     A,#050H
0044 FE                MOV     R6,A
0045 E4                CLR     A
0046 35F0              ADDC    A,B
0048 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
004B F0                MOVX    @DPTR,A
004C A3                INC     DPTR
004D CE                XCH     A,R6
004E F0                MOVX    @DPTR,A
004F 7D03              MOV     R5,#03H
0051 7C00              MOV     R4,#00H
0053 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 85
0056 8045              SJMP    ?C0020
0058         ?C0019:
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
0058 900000      R     MOV     DPTR,#flag
005B E0                MOVX    A,@DPTR
005C 703F              JNZ     ?C0020
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 90
005E 900000      R     MOV     DPTR,#channel
0061 E0                MOVX    A,@DPTR
0062 FF                MOV     R7,A
0063 75F019            MOV     B,#019H
0066 A4                MUL     AB
0067 2400        E     ADD     A,#LOW channels+0DH
0069 F582              MOV     DPL,A
006B E4                CLR     A
006C 3400        E     ADDC    A,#HIGH channels+0DH
006E F583              MOV     DPH,A
0070 E4                CLR     A
0071 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 91
0072 EF                MOV     A,R7
0073 75F019            MOV     B,#019H
0076 A4                MUL     AB
0077 2400        E     ADD     A,#LOW channels+0DH
0079 F9                MOV     R1,A
007A 7400        E     MOV     A,#HIGH channels+0DH
007C 35F0              ADDC    A,B
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 12  

007E FA                MOV     R2,A
007F 7B01              MOV     R3,#01H
0081 900000      R     MOV     DPTR,#channel
0084 E0                MOVX    A,@DPTR
0085 75F003            MOV     B,#03H
0088 A4                MUL     AB
0089 2450              ADD     A,#050H
008B FE                MOV     R6,A
008C E4                CLR     A
008D 35F0              ADDC    A,B
008F 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
0092 F0                MOVX    @DPTR,A
0093 A3                INC     DPTR
0094 CE                XCH     A,R6
0095 F0                MOVX    @DPTR,A
0096 7D03              MOV     R5,#03H
0098 7C00              MOV     R4,#00H
009A 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 92
                                           ; SOURCE LINE # 93
009D         ?C0020:
                                           ; SOURCE LINE # 95
009D 120000      R     LCALL   Calibrate_Get_CRC
00A0 E4                CLR     A
00A1 FC                MOV     R4,A
00A2 FD                MOV     R5,A
00A3 FE                MOV     R6,A
00A4 900000      R     MOV     DPTR,#true_crc
00A7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 96
00AA 7B01              MOV     R3,#01H
00AC 7A00        R     MOV     R2,#HIGH true_crc
00AE 7900        R     MOV     R1,#LOW true_crc
00B0 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
00B3 E4                CLR     A
00B4 F0                MOVX    @DPTR,A
00B5 A3                INC     DPTR
00B6 74A1              MOV     A,#0A1H
00B8 F0                MOVX    @DPTR,A
00B9 7D01              MOV     R5,#01H
00BB 7C00              MOV     R4,#00H
00BD 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 97
00C0 22                RET     
             ; FUNCTION _Calibrate_Set_Flag (END)

             ; FUNCTION Calibrate_Set_Default (BEGIN)
                                           ; SOURCE LINE # 99
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 101
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 102
0005 A3                INC     DPTR
0006 120000      E     LCALL   ?C?LSTKXDATA
0009 00                DB      00H
000A 00                DB      00H
000B 00                DB      00H
000C 00                DB      00H
                                           ; SOURCE LINE # 104
000D E4                CLR     A
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 13  

000E 900000      R     MOV     DPTR,#i
0011 F0                MOVX    @DPTR,A
0012         ?C0023:
0012 900000      R     MOV     DPTR,#i
0015 E0                MOVX    A,@DPTR
0016 FF                MOV     R7,A
0017 C3                CLR     C
0018 9406              SUBB    A,#06H
001A 500D              JNC     ?C0024
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 106
001C E4                CLR     A
001D FD                MOV     R5,A
001E 120000      R     LCALL   _Calibrate_Set_Flag
                                           ; SOURCE LINE # 107
0021 900000      R     MOV     DPTR,#i
0024 E0                MOVX    A,@DPTR
0025 04                INC     A
0026 F0                MOVX    @DPTR,A
0027 80E9              SJMP    ?C0023
0029         ?C0024:
                                           ; SOURCE LINE # 109
0029 120000      R     LCALL   Calibrate_Get_CRC
002C E4                CLR     A
002D FC                MOV     R4,A
002E FD                MOV     R5,A
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#true_crc
0033 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 110
0036 7B01              MOV     R3,#01H
0038 7A00        R     MOV     R2,#HIGH true_crc
003A 7900        R     MOV     R1,#LOW true_crc
003C 900000      E     MOV     DPTR,#?_EEPROM_Write?BYTE+05H
003F E4                CLR     A
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 74A1              MOV     A,#0A1H
0044 F0                MOVX    @DPTR,A
0045 7D01              MOV     R5,#01H
0047 7C00              MOV     R4,#00H
0049 120000      E     LCALL   _EEPROM_Write
                                           ; SOURCE LINE # 111
004C 22                RET     
             ; FUNCTION Calibrate_Set_Default (END)

C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 14  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
SCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
WDCON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C0H  1
T2CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
ADCSTAT. . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D8H  1
I2CCON . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
DCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
SPICON . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00F8H  1
_EEPROM_Read . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
_EEPROM_Write. . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
CHNL_ADC_0 . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CHNL_ADC_1 . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CHNL_ADC_2 . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CHNL_ADC_3 . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CHNL_FREQ_COUNT_T_0. . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CHNL_FREQ_COUNT_T_1. . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Channel. . . . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  25
  number . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  settings . . . . . . . . . . . . . .  MEMBER   -----  UNION    0001H  4
  channel_data . . . . . . . . . . . .  MEMBER   -----  U_LONG   0005H  4
  channel_data_calibrate . . . . . . .  MEMBER   -----  U_LONG   0009H  4
  calibrate. . . . . . . . . . . . . .  MEMBER   -----  UNION    000DH  12
lc_t . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
pt . . . . . . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  4
  lc . . . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
  pt_time. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0002H  2
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
ADC_Channels . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  38
  ADC_BUF_UN . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  32
  adc_buf_counter. . . . . . . . . . .  MEMBER   -----  U_CHAR   0020H  1
  ADC_SF . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0021H  1
  ADC_GAIN . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0022H  1
  buffered . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0023H  1
  unipolar . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0024H  1
  new_measuring. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0025H  1
channels . . . . . . . . . . . . . . .  EXTERN   XDATA  ARRAY    -----  150
Crc8Table. . . . . . . . . . . . . . .  EXTERN   CODE   ARRAY    -----  -----
RESET. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
SET. . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
_Calibrate . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  channel_num. . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  K. . . . . . . . . . . . . . . . . .  AUTO     XDATA  FLOAT    0001H  4
  C. . . . . . . . . . . . . . . . . .  AUTO     XDATA  FLOAT    0005H  4
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0009H  4
RestoreCalibrate . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  crc. . . . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0001H  4
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0005H  4
_GetCalibrateVal . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  channel_num. . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  ADC_Code . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0001H  4
  result . . . . . . . . . . . . . . .  AUTO     XDATA  FLOAT    0005H  4
C51 COMPILER V9.00   CALIBRATE                                                             05/22/2015 09:20:44 PAGE 15  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


Calibrate_Get_CRC. . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  crc. . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  i. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0001H  1
  j. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0002H  1
_Calibrate_Set_Flag. . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  channel. . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  flag . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0001H  1
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0002H  4
Calibrate_Set_Default. . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  true_crc . . . . . . . . . . . . . .  AUTO     XDATA  U_LONG   0001H  4


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    861    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      45
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
