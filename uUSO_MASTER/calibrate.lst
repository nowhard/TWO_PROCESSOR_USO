C51 COMPILER V9.00   CALIBRATE                                                             04/24/2015 12:10:37 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CALIBRATE
OBJECT MODULE PLACED IN calibrate.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE calibrate\calibrate.c LARGE OPTIMIZE(9,SPEED) BROWSE ORDER NO
                    -AREGS MODAB2 DEBUG OBJECTEXTEND PRINT(.\calibrate.lst) OBJECT(calibrate.obj)

line level    source

   1          #include "calibrate.h"
   2          #pragma OT(6,Speed)
   3          //------------------------------------------------------------
   4          unsigned long GetCalibrateVal(unsigned char channel_num,unsigned long ADC_Code)   //преобразование значени
             -я АЦП в калиброванное значение         ??? проверить && debug
   5          {
   6   1              float result=0;
   7   1      
   8   1              result=ADC_Code*channels[channel_num].calibrate.cal.K+channels[channel_num].calibrate.cal.C;
   9   1      
  10   1              if(result>(float)0xFFFFFF)
  11   1              {
  12   2                      return 0xFFFFFF;
  13   2              }
  14   1              else
  15   1              {
  16   2                      if(result<0)
  17   2                      {
  18   3                              return 0;
  19   3                      }
  20   2                      else
  21   2                      {
  22   3                              return (unsigned long)result; 
  23   3                      }
  24   2              }
  25   1      }
  26          //------------------------------------------------------------
  27          void RestoreCalibrate(void)              //восстановление точек калибровки из EEPROM
  28          {
  29   1              unsigned char i=0;
  30   1              for(i=0;i<CHANNEL_NUMBER;i++)
  31   1              {
  32   2                      EEPROM_Read(&channels[i].calibrate.serialize,3,ADC_CALIBRATE_ADDR+i*3);
  33   2              }
  34   1      
  35   1              return;
  36   1      }
  37          //---------------------------------------------------------------
  38          void Calibrate(unsigned char channel_num,float K,float C) //общая функция калибровки
  39          {
  40   1                      channels[channel_num].calibrate.cal.K= K;
  41   1                      channels[channel_num].calibrate.cal.C= C;
  42   1                      EEPROM_Write(&channels[channel_num].calibrate.serialize,3,ADC_CALIBRATE_ADDR+channel_num*3);
  43   1                      return;
  44   1      }
  45          //---------------------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    365    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      19
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.00   CALIBRATE                                                             04/24/2015 12:10:37 PAGE 2   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
