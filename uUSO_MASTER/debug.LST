C51 COMPILER V9.00   DEBUG                                                                 06/20/2014 13:19:15 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DEBUG
OBJECT MODULE PLACED IN debug.OBJ
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE debug.c LARGE OPTIMIZE(6,SPEED) BROWSE ORDER NOAREGS DEBUG OB
                    -JECTEXTEND

line level    source

   1          #include <ADuC845.h>
   2          
   3          
   4          #include "timer3.h"
   5          #include "proto_uso/proto_uso.h"
   6          #include "preferences.h"
   7          #include "eeprom/eeprom.h"
   8          #include "timer1.h"
   9          #include "adc.h"
  10          #include "watchdog.h"
  11          #include "proto_uso/channels.h"
  12          #include "frequency.h"
  13          
  14          #include "i2c.h"
  15          #include "ulongsort.h"
  16          
  17          #include "calibrate/calibrate.h"
  18          #include "pt/pt.h"
  19          
  20          
  21          
  22          extern unsigned char idata i2c_buffer[6];
  23          
  24          extern struct I2C_Channel xdata i2c_channels;
  25          extern struct pt pt_proto, pt_wdt;
  26          volatile struct pt pt_i2c_read, pt_freq_measure,pt_sort,pt_i2c_process;
  27          
  28          
  29          //-----------------------------------------
  30          void Set_Handlers(void);//установить обработчики событий
  31          PT_THREAD(I2C_RepeatRead(struct pt *pt));
  32           //---------------------------------------
  33          
  34          void main(void) //using 0
  35          {                          
  36   1              EA = 0;
  37   1              
  38   1              
  39   1              PLLCON&=PLLCON_VAL;//настройка частоты процессора
  40   1              
  41   1              RestoreCalibrate();
  42   1              
  43   1              ChannelsInit();//инициализаци€ настроек каналов
  44   1              Protocol_Init();        
  45   1              Timer1_Initialize(); //таймер шедулера 200√ц    
  46   1              ADC_Initialize();
  47   1              UART_Init();
  48   1              Frequency_Init();
  49   1      
  50   1              WDT_Init(WDT_2000);//включить сторожевой таймер
  51   1              I2C_Init();
  52   1      
  53   1      
  54   1              
C51 COMPILER V9.00   DEBUG                                                                 06/20/2014 13:19:15 PAGE 2   

  55   1              PT_INIT(&pt_i2c_read);
  56   1              PT_INIT(&pt_freq_measure);
  57   1              PT_INIT(&pt_sort);
  58   1              PT_INIT(&pt_i2c_process);
  59   1      
  60   1              EA=1;
  61   1      
  62   1              i2c_buffer[0]=0x0;//сброс флага инициализации
  63   1      
  64   1              I2C_Repeat_Start_Read(I2C_ADDR,&i2c_buffer,1,i2c_channels.I2C_CHNL.i2c_buf,sizeof(i2c_channels));         //про
             -изводим первое чтение заранее
  65   1              while(1)
  66   1              {       
  67   2                      ProtoProcess(&pt_proto);
  68   2                      I2C_RepeatRead(&pt_i2c_read);
  69   2                      Frequency_Measure_Process(&pt_freq_measure);    
  70   2                      ulongsort_process(&pt_sort);
  71   2                      I2C_Process(&pt_i2c_process);
  72   2                      WDT_Process(&pt_wdt);       
  73   2              }
  74   1      }
  75          //-----------------------------------------------------------------------------
  76          //#pragma OT(0,Speed)
  77           //---------------------------------
  78           PT_THREAD(I2C_RepeatRead(struct pt *pt))//поток чтени€ I2C
  79           {  
  80   1                wdt_count[I2C_RepeatRead_Proc].process_state=RUN;
  81   1                 
  82   1                PT_BEGIN(pt);
  83   3                
  84   3                while(1) 
  85   3                {
  86   4                              PT_DELAY(pt,15);
  87   4                              I2C_Repeat_Start_Read(I2C_ADDR,&i2c_buffer,1,i2c_channels.I2C_CHNL.i2c_buf,sizeof(i2c_channels));       //исп
             -равить сдвиг адресации
  88   4                              //WDT_Clear();
  89   4                              wdt_count[I2C_RepeatRead_Proc].count++;
  90   4                }
  91   3                PT_END(pt);
  92   1      
  93   1       }
  94          //-----------------------------------
  95          void Timer1_Interrupt(void) interrupt 3  //таймер шедулера
  96          {
  97   1      //---------------------------------------
  98   1              TH1     = TH1_VAL; ///200 Hz;
  99   1              TL1 = TL1_VAL;//
 100   1              pt_i2c_read.pt_time++;
 101   1              pt_freq_measure.pt_time++;
 102   1              pt_sort.pt_time++;
 103   1              pt_proto.pt_time++;
 104   1              pt_wdt.pt_time++;
 105   1              return; 
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    414    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     16       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.00   DEBUG                                                                 06/20/2014 13:19:15 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
