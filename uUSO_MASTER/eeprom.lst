C51 COMPILER V9.00   EEPROM                                                                06/20/2014 09:13:36 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN eeprom.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE eeprom\eeprom.c LARGE OPTIMIZE(6,SPEED) BROWSE ORDER NOAREGS 
                    -DEBUG OBJECTEXTEND PRINT(.\eeprom.lst) OBJECT(eeprom.obj)

line level    source

   1          #include "eeprom.h"
   2          
   3           //----------------------------------------------------------------------------------
   4          unsigned int  EEPROM_Write(void *buffer,unsigned int len,unsigned int addr) //using 0//записать буфер по а
             -дресу
   5          {
   6   1      //небезопасная
   7   1        unsigned int i=0;
   8   1        unsigned char *buf;
   9   1      
  10   1        unsigned char ea_temp=0;//сохраним EA
  11   1                                                         
  12   1        if (addr+len>= EEMEM_SIZE) //если адрес выходит за границы
  13   1              return (0UL);
  14   1      
  15   1              buf=buffer;
  16   1      
  17   1         for(i=0;i<len;i++)
  18   1         {
  19   2                      ea_temp=EA;
  20   2                      EA=0;      
  21   2                 
  22   2                 EDATA1=buf[i*4]; 
  23   2                 EDATA2=buf[i*4+1]; 
  24   2                 EDATA3=buf[i*4+2]; 
  25   2                 EDATA4=buf[i*4+3]; 
  26   2                
  27   2                 EADR=addr;
  28   2      
  29   2                 ECON=EE_ERASE_PAGE;
  30   2                 ECON=EE_WRITE_PAGE;
  31   2      
  32   2                 EA=ea_temp;
  33   2                
  34   2                 addr++;
  35   2         }
  36   1      
  37   1         return i;
  38   1      }
  39          //----------------------------------------------------------------------------------
  40          unsigned int EEPROM_Read(void *buffer,unsigned int len,unsigned int addr) //using 0//прочитать несколько с
             -траниц с адреса
  41          {
  42   1      //небезопасная
  43   1      
  44   1        unsigned int  i=0;
  45   1        unsigned char *buf;
  46   1      
  47   1         unsigned char ea_temp=0;//сохраним EA
  48   1      
  49   1        if (addr+len>= EEMEM_SIZE) //если адрес выходит за границы
  50   1              return (0UL);
  51   1      
  52   1         buf=buffer;
C51 COMPILER V9.00   EEPROM                                                                06/20/2014 09:13:36 PAGE 2   

  53   1              
  54   1         for(i=0;i<len;i++)
  55   1         {
  56   2                ea_temp=EA;
  57   2                EA=0;
  58   2                
  59   2                 EADR=addr;
  60   2                 ECON=EE_READ_PAGE;
  61   2                 
  62   2                 buf[i*4]  =EDATA1; 
  63   2                 buf[i*4+1]=EDATA2; 
  64   2                 buf[i*4+2]=EDATA3; 
  65   2                 buf[i*4+3]=EDATA4; 
  66   2      
  67   2                 EA=ea_temp;
  68   2      
  69   2                 addr++;
  70   2         }  
  71   1      
  72   1         return i;
  73   1      }
  74          
  75          //----------------------------------------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    450    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
